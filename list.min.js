(function(e){"use strict";var t="list";var n={forceHelperStyle:true,helper:"dragging",placeholder:"placeholder",placeholderElement:null,forcePlaceholderSize:true,placeholderSpeed:100,additonSpeed:100,removalSpeed:100,revert:100,selectable:true,nonselection:true,selectee:"active",items:">*",multiselectable:true,multiselectOnKey:true,sortable:true,scroll:true,scrollInStopping:true,scrollSensitivity:40,scrollSpeed:1,scrollDelay:10,disabled:false,disabledClass:"disabled",shiftZIndex:100,unselectOnClick:true,selected:null,selecting:null,unselected:null,unselecting:null,change:null,start:null,stop:null,update:null,click:null,observing:null,observe:null};var r={space:32,pageUp:33,pageDown:34,end:35,home:36,up:38,down:40};var i=function(e,t){return e["r"+t]||e["webkitR"+t]||e["mozR"+t]||e["msR"+t]||e["oR"+t]||function(t){return e.setTimeout(t,1e3/60)}}(window,"equestAnimationFrame");e.fn.list=function(n){if(typeof n==="string"){var r=this.data(t);if(typeof r==="object"){if(!(n in r)){throw"list.js Error: list.js has no method '"+n+"'"}var i=r[n].apply(r,Array.prototype.slice.call(arguments,1));return i===void 0?this:i}}else{this.each(function(){var r=e(this);r.data(t,new e.list(r,n))})}return this};e.list=function(e,t){this.init.apply(this,arguments)};e.list.prototype.init=function(s,o){function a(){if(u.dragging===null||u.options.scroll!==true)return;u.element.scrollTop(Math.max(0,u.element.scrollTop()-u.options.scrollSpeed));if(u.dragging.isScrollingOnEdge!==false){if(u.options.scrollDelay>0)setTimeout(a,u.options.scrollDelay);else i(a)}}function f(){if(u.dragging===null||u.options.scroll!==true)return;var e=u.element.scrollTop();u.element.scrollTop(Math.min(u.element.prop("scrollHeight"),e+u.options.scrollSpeed));if(u.dragging.isScrollingOnEdge!==false){if(u.options.scrollDelay>0)setTimeout(f,u.options.scrollDelay);else i(f)}}function l(e){var t=u.dragging.currentX-u.dragging.mouseX+u.dragging.startX;var n=u.dragging.currentY-u.dragging.mouseY+u.dragging.startY;u.dragging.target.css({left:t,top:n});var r=u.dragging.placeholder.index();var i=u.pureItems();var s;for(var o=0;o<i.length;o++){s=i.eq(o);if(o===i.length-1||s.offset().top+s.height()/2>=n)break}if(o!==r){u.shift(r,o,0);if(typeof u.options.change==="function"){u.options.change.call(u,e,u.dragging.target,r,o)}}}function c(t){if(u.dragging===null||u.options.disabled===true){u.cancel();return}if(t.pageX!==u.dragging.mouseX||t.pageY!==u.dragging.mouseY){if(u.dragging.isDragging===true){u.dragging.currentX=t.pageX;u.dragging.currentY=t.pageY;if(u.options.scroll===true){u.dragging.isScrollingOnEdge=false;var n=u.element.offset().left;var r=u.element.offset().top;var i=u.element.outerWidth();var s=u.element.outerHeight();var o=u.options.scrollSensitivity;var c=u.dragging.currentX;var h=u.dragging.currentY;if(c>n&&c<n+i){if(h>=r&&h<r+o){if(u.options.scrollInStopping===true)u.dragging.isScrollingOnEdge=true;a()}else if(h>r+s-o&&h<=r+s){if(u.options.scrollInStopping===true)u.dragging.isScrollingOnEdge=true;f()}}}l(t)}else if(u.options.sortable===true){if(u.dragging.placeholder===null){if(u.options.placeholderElement===null){u.dragging.placeholder=e("<"+u.dragging.target[0].nodeName+">");if(typeof u.options.placeholder==="string"&&u.options.placeholder.length>0){u.dragging.placeholder.addClass(u.options.placeholder)}}else{u.dragging.placeholder=u.options.placeholderElement}}if(u.options.forcePlaceholderSize===true){u.dragging.placeholder.css("height",u.dragging.target.height()+"px")}if(typeof u.options.helper==="string"&&u.options.helper.length>0){u.dragging.target.addClass(u.options.helper)}u.dragging.isDragging=true;u.dragging.currentX=t.pageX;u.dragging.currentY=t.pageY;if(u.options.forceHelperStyle===true){u.dragging.target.css({position:"absolute",width:u.dragging.target.width()})}u.dragging.placeholder.insertAfter(u.dragging.target);u.dragging.target.appendTo(e("body"));l(t);if(typeof u.options.start==="function"){u.options.start.call(u,t,u,u.dragging.target)}}}}function h(n){e(document).off("mousemove."+t+u.id+" mouseup."+t+u.id);if(u.dragging===null)return;if(u.options.disabled!==true){if(u.dragging.isDragging===true)u.cancel();else if(u.options.disabled!==true&&u.dragging.isDragging!==true)p(n)}u.dragging=null}function p(t){if(u.options.selectable===true){var n=u.selectedItems();var r=u.dragging.target.hasClass(u.options.selectee);if(u.options.multiselectable===true||u.options.multiselectOnKey===true&&t.ctrlKey){if(r===true){if(n.length>1||u.options.nonselection===true){var i;if(typeof u.options.unselecting==="function"){i=u.options.unselecting.call(u,t,u.dragging.target)}if(i!==false){u.dragging.target.removeClass(u.options.selectee);if(typeof u.options.unselected==="function"){u.options.unselected.call(u,t,u.dragging.target)}}}}else{var s;if(typeof u.options.selecting==="function"){s=u.options.selecting.call(u,t,u.dragging.target)}if(s!==false){u.dragging.target.addClass(u.options.selectee);if(typeof u.options.selected==="function"){u.options.selected.call(u,t,u.dragging.target)}}}}else{if(r===true&&(u.options.nonselection!==true&&n.length===1||u.options.nonselection===true&&n.length>1||u.options.multiselectable!==true&&n.length>1)){n=n.filter(function(){return!e(this).is(u.dragging.target)})}if(n.length>0){n.removeClass(u.options.selectee);var o;if(typeof u.options.unselecting==="function"){o=u.options.unselecting.call(u,t,u.dragging.target)}if(o!==false&&typeof u.options.unselected==="function"){n.each(function(){u.options.unselected.call(u,t,e(this))})}}if(r!==true){var a;if(typeof u.options.selecting==="function"){a=u.options.selecting.call(u,t,u.dragging.target)}if(a!==false){u.dragging.target.addClass(u.options.selectee);if(typeof u.options.selected==="function"){u.options.selected.call(u,t,u.dragging.target)}}}}}if(typeof u.options.click==="function"){u.options.click.call(u,t,u,u.dragging.target)}}var u=this;this.element=s;this.options=e.extend(true,{},e.extend(n,o));this.dragging=null;this.isPlaying=false;this.removing=[];this.shifting=[];this.swapping=[];if(this.id){e(document).off("mousemove."+t+this.id+" mouseup."+t+this.id)}this.id=Math.random().toString(36).slice(2);s.on("click."+t,function(e){if(u.options.unselectOnClick===true&&u.options.nonselection===true){u.unselect()}}).on("click."+t,">*",function(e){e.stopPropagation()});s.on("keyup."+t,this.options.items,function(t){switch(t.which){case r.space:e(this).mousedown().mouseup();t.preventDefault();break;case r.pageDown:case r.end:u.items().last().focus();t.preventDefault();break;case r.pageUp:case r.home:u.items().first().focus();t.preventDefault();break;case r.up:e(this).prev().focus();t.preventDefault();break;case r.down:e(this).next().focus();t.preventDefault();break}});s.on("mousedown."+t,this.options.items,function(n){n.currentTarget.focus();n.preventDefault();var r=e(this);if(u.options.disabled===true||u.removing.indexOf(r.index())>-1)return;u.dragging={target:r,index:r.index(),mouseX:n.pageX,mouseY:n.pageY,currentX:n.pageX,currentY:n.pageY,startX:r.offset().left,startY:r.offset().top,isDragging:false,isScrollingOnEdge:false,placeholder:null};e(document).on("mousemove."+t+u.id,c).one("mouseup."+t+u.id,h)})};e.list.prototype.destroy=function(){this.cancel();this.element.off("mousedown."+t+" keyup."+t);e(document).off("mousemove."+t+this.id+" mouseup."+t+this.id);this.element.removeData(t);this.dragging=null};e.list.prototype.enable=function(){this.options.disabled=false;if(typeof this.options.disabledClass==="string")this.element.removeClass(this.options.disabledClass)};e.list.prototype.disable=function(){this.cancel();this.options.disabled=true;if(typeof this.options.disabledClass==="string")this.element.addClass(this.options.disabledClass)};e.list.prototype.option=function(e,t){if(arguments.length===0)return this.options;else if(t===void 0)return this.options[e];else this.options[e]=t};e.list.prototype.instance=function(){return this};e.list.prototype.widget=function(){return this.element};e.list.prototype.serialize=function(t){var n=[];t=t||{};this.items().each(function(){var r=(e(this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);if(r){n.push((t.key||r[1]+"[]")+"="+(t.key&&t.expression?r[1]:r[2]))}});if(!n.length&&t.key){n.push(t.key+"=")}return n.join("&")};e.list.prototype.toArray=function(){var e=[];this.items().each(function(){e.push(this.id)});return e};e.list.prototype.cancel=function(n){function i(e,t,n,i,s){e.insertBefore(t);var o=t.next();t.remove();if(r.options.forceHelperStyle===true){e.css({position:"",top:"",width:""})}if(typeof r.options.helper==="string"&&r.options.helper.length>0){e.removeClass(r.options.helper)}r.isPlaying=false;if(typeof r.options.update==="function"&&s>=0){r.options.update.call(r,n,e,i,s)}if(typeof r.options.stop==="function"&&s>=0){r.options.stop.call(r,n,e)}}var r=this;e(document).off("mousemove."+t+this.id+" mouseup."+t+this.id);if(this.dragging===null)return;if(this.dragging.isDragging===true){var s=-1;if(this.dragging.index!==this.dragging.placeholder.index())s=this.dragging.placeholder.index();var o=this.dragging.target;var u=this.dragging.placeholder;var a=this.dragging.index;if(this.options.revert>0){o.animate({top:u.offset().top,left:u.offset().left},this.options.revert,"swing",function(){i(o,u,n,a,s)});this.isPlaying=true}else{i(o,u,n,a,s)}}this.dragging=null};e.list.prototype.select=function(t,n){if(n===true||n===void 0&&this.options.multiselectable!==true)this.unselect(t,true);var r=this;var i;if(typeof t==="number")i=this.items().eq(t);else if(t instanceof Array)i=this.items().filter(function(e){return t.indexOf(e)>=0});else i=this.items();if(typeof this.options.selecting==="function"){i=i.filter(function(){return r.options.selecting.call(r,null,e(this))!==false})}if(i.length>0){i.addClass(this.options.selectee);if(typeof this.options.selected==="function"){i.each(function(){r.options.selected.call(r,null,e(this))})}}};e.list.prototype.unselect=function(t,n){var r=this;var i;if(n===true)i=this.selectedItems().filter(t instanceof Array?function(){return t.indexOf(e(this).index())<0}:function(){return e(this).index()!==t});else if(t instanceof Array)i=this.selectedItems().filter(function(e){return t.indexOf(e)>=0});else if(typeof t==="number"){i=this.items().eq(t).filter(function(){return r.isSelected(r.index(e(this).index()))})}else i=this.selectedItems();if(typeof this.options.unselecting==="function"){i=i.filter(function(){return r.options.unselecting.call(r,null,e(this))!==false})}if(i.length>0){i.removeClass(this.options.selectee);if(typeof this.options.unselected==="function"){i.each(function(){r.options.unselected.call(r,null,e(this))})}}};e.list.prototype.toggle=function(e){var t;if(e instanceof Array)t=this.items().filter(function(t){return e.indexOf(t)>=0});else if(typeof e==="number")t=this.items().eq(e);else t=this.items();t.toggleClass(this.options.selectee)};e.list.prototype.click=function(e){this.items().eq(e).mousedown().mouseup()};e.list.prototype.items=function(){var t=this,n,r,i;var s=this.dragging===null?this.pureItems():this.pureItems().map(function(){if(e(this).is(t.dragging.placeholder)){return t.dragging.target.get(0)}return this});for(var o=0;o<this.shifting.length;o++){n=this.shifting[o].from;r=this.shifting[o].to;s.splice(r+1,0,s[n]);s.splice(n>r?n+1:n,1)}for(o=0;o<this.swapping.length;o++){n=this.swapping[o].from;r=this.swapping[o].to;i=s[n];s[n]=s[r];s[r]=i}return s};e.list.prototype.pureItems=function(){var e=this;return this.element.find(this.options.items).filter(function(t){return e.removing.indexOf(t)===-1})};e.list.prototype.index=function(e){var t=this.items();for(var n=0;n<t.length;n++){if(e===t.eq(n).index())return n}return-1};e.list.prototype.selectedItems=function(){var t=this;return this.items().filter(function(){return e(this).hasClass(t.options.selectee)})};e.list.prototype.isSelected=function(e){return this.items().eq(e).hasClass(this.options.selectee)};e.list.prototype.add=function(t,n,r){if(typeof t==="string"){var i;if(this.element[0].nodeName==="UL"||this.element[0].nodeName==="OL")i="li";else i=this.item()[0].nodeName;t=e("<"+i+">",{text:t})}else{t=e(t)}t.hide();var s=this.items();if(n>=0&&n<s.length){s.eq(n).before(t)}else{this.element.append(t)}if(r===void 0)r=-1;if(r>0||r<0&&this.options.additonSpeed>0){t.slideDown(r<0?this.options.additonSpeed:r)}else{t.show()}};e.list.prototype.remove=function(t,n){var r=this;var i=r.items();var s;if(t instanceof Array){s=i.filter(function(e){return t.indexOf(e)>=0})}else if(typeof t==="number"){s=i.eq(t)}else{s=this.selectedItems().filter(function(){return r.removing.indexOf(e(this).index())===-1})}if(s.length===0)return;var o=false;s.each(function(){if(r.dragging!==null&&r.dragging.target.is(this)){o=true}var t=r.index(e(this).index());if(r.isSelected(t)===true)r.unselect(t)});if(o)this.cancel();if(n===0&&this.options.removalSpeed<=0){s.remove()}else{if(n===void 0)n=this.options.removalSpeed;var u=s.map(function(){return e(this).index()}).get();this.removing=e.unique(this.removing.concat(u));s.each(function(){var t=e(this);var i=t.index();t.slideUp(n,function(e){return function(){var n=r.removing.indexOf(e);if(n>-1)r.removing.splice(n,1);t.remove()}}(i))})}};e.list.prototype.empty=function(e){this.unselect();var t=this.items();if(e===0&&this.options.removalSpeed<=0){t.remove()}else{if(e===void 0)e=this.options.removalSpeed;t.slideUp(e,function(){t.remove()})}};e.list.prototype.shiftUp=function(t){var n=this.selectedItems();if(this.isPlaying===true||n.length<=0||this.index(n.first().index())===0)return;var r=this;var i=-1,s,o=[];n.each(function(){s=r.index(e(this).index());if(i===-1){o.push({down:s-1,up:-1})}if(i>-1&&s-i>1){o[o.length-1].up=i;o.push({down:s-1,up:-1})}if(s===r.index(n.last().index())){o[o.length-1].up=s}i=s});e.each(o,function(){r.shift(this.down,this.up,t,true)})};e.list.prototype.shiftDown=function(t){var n=this.selectedItems();if(this.isPlaying===true||n.length<=0||this.index(n.last().index())>=this.items().length-1)return;var r=this;var i=-1,s,o=[];n.each(function(){s=r.index(e(this).index());if(i===-1){o.push({down:s,up:-1})}if(i>-1&&s-i>1){o[o.length-1].up=i+1;o.push({down:s,up:-1})}if(s===r.index(n.last().index())){o[o.length-1].up=s+1}i=s});e.each(o,function(){r.shift(this.up,this.down,t,true)})};e.list.prototype.shift=function(t,n,r,i){var s=this.pureItems();if(t===n||t<0||n<0||t>=s.length||n>=s.length)return;var o=s.eq(t);var u=s.eq(n);var a=this;if(typeof a.options.observing==="function"){a.options.observing.call(a,t,n,o,u,"shift")}if(r!==0&&this.options.placeholderSpeed>0){if(r===void 0||r<0){r=this.options.placeholderSpeed}var f=this.items().slice(t<n?t+1:n,t<n?n+1:t);var l=0;f.each(function(){l+=e(this).outerHeight()});var c={from:t,to:n};this.shifting.push(c);if(i===true)f.css("z-index",this.options.shiftZIndex);f.css({position:"relative",left:0}).animate({top:o.outerHeight()*(t<n?-1:1)},r);o.css({position:"relative",left:0}).animate({top:l*(t<n?1:-1)},r,"swing",function(){if(i===true)f.css("z-index","");else o.css("z-index","");f.css({position:"",left:"",top:""});o.css({position:"",left:"",top:""});u[t<n?"after":"before"](o);var e=a.shifting.indexOf(c);if(e>=0)a.shifting.splice(e,1);a.isPlaying=false;if(typeof a.options.observe==="function"){a.options.observe.call(a,t,n,o,u,"shift")}});this.isPlaying=true}else{u[t<n?"after":"before"](o);if(typeof a.options.observe==="function"){a.options.observe.call(a,t,n,o,u,"shift")}}};e.list.prototype.swap=function(e,t,n){if(this.isPlaying===true)return;var r=this;var i=this.element;var s=this.pureItems();if(e>t){var o=t;t=e;e=o}var u=s.eq(e);var a=s.eq(t);var f=function(){u.insertAfter(a);if(a.index()!==e)a.insertBefore(u);if(typeof r.options.observe==="function"){r.options.observe.call(r,e,t,u,a,"swap")}};if(typeof r.options.observing==="function"){r.options.observing.call(r,e,t,u,a,"swap")}if(n!==0&&this.options.placeholderSpeed>0){if(n===void 0||n<0){n=this.options.placeholderSpeed}var l={from:e,to:t};this.swapping.push(l);u.css({position:"relative",left:0}).animate({top:a.offset().top-u.offset().top},n,"swing");a.css({position:"relative",left:0}).animate({top:u.offset().top-a.offset().top},n,"swing",function(){u.css({position:"",top:"",left:""});a.css({position:"",top:"",left:""});f();var e=r.swapping.indexOf(l);if(e>=0)r.swapping.splice(e,1);r.isPlaying=false});this.isPlaying=true}else{f()}}})(jQuery)